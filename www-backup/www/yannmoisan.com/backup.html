<!DOCTYPE html>
<html lang="fr"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="6C_Yu8j-I-U3pjFBjHojSiqvDPxhKJuYqap_tSXV8M4" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Sauvegarde | Yann Moisan</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Sauvegarde" />
<meta property="og:locale" content="fr" />
<meta name="description" content="Stratégie de sauvegarde d’un ordinateur personnel" />
<meta property="og:description" content="Stratégie de sauvegarde d’un ordinateur personnel" />
<link rel="canonical" href="https://www.yannmoisan.com/backup.html" />
<meta property="og:url" content="https://www.yannmoisan.com/backup.html" />
<meta property="og:site_name" content="Yann Moisan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-03-11T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Sauvegarde" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2013-03-11T00:00:00+01:00","datePublished":"2013-03-11T00:00:00+01:00","description":"Stratégie de sauvegarde d’un ordinateur personnel","headline":"Sauvegarde","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yannmoisan.com/backup.html"},"url":"https://www.yannmoisan.com/backup.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" /><link type="application/atom+xml" rel="alternate" href="https://www.yannmoisan.com/feed.xml" title="Yann Moisan" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Yann Moisan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/">Posts</a><a class="page-link" href="/news-from-last-month.html">News from last month</a><a class="page-link" href="/a-propos.html">About me</a><a class="page-link" href="/bookmarks.html">Bookmarks</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sauvegarde</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-03-11T00:00:00+01:00" itemprop="datePublished">Mar 11, 2013
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Nos données sont précieuses. La
<a href="http://fr.wikipedia.org/wiki/Sauvegarde_%28informatique%29">sauvegarde</a> est donc un sujet critique,
qu’il faut maitriser parfaitement. Je fuis donc les applications graphiques qui masquent certaines
choses. La sauvegarde doit s’effectuer automatiquement, le plus rapidement possible et en conservant
si possible un historique des dernières versions.</p>

<p>Je sauvegarde sur un disque USB externe. La vitesse d’<em>upload</em>, limité à 100k, ne permettant pas de
réaliser confortablement des sauvegardes en ligne.</p>

<p>L’outil de prédilection est rsync, disponible sur la plupart des distributions Linux. C’est un outil
de sauvegarde incrémentale, rapide, avec une syntaxe très simple : rsync options source dest.</p>

<p>Mais rsync dispose aussi de nombreuses options.</p>

<h2 id="sauvegarde-différentielle">Sauvegarde différentielle</h2>

<p>Le principe est de ne stocker que la différence avec la sauvegarde précédente.</p>

<p>Commençons par mettre les mains dans le cambouis pour se familiariser avec l’outil :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>rsynctest
<span class="nb">cd </span>rsynctest
<span class="nb">mkdir</span> <span class="o">{</span>src,dst,bkp<span class="o">}</span>
<span class="nb">echo </span>a <span class="o">&gt;</span> src/a
<span class="nb">echo </span>b <span class="o">&gt;</span> src/b
rsync <span class="nt">-a</span> <span class="nt">--delete</span> <span class="nt">-b</span> <span class="nt">--backup-dir</span><span class="o">=</span>/home/yamo/rsynctest/bkp ~/rsynctest/src/ ~/rsynctest/dst
ll <span class="nt">-R</span>
<span class="nb">rm </span>src/b
<span class="nb">echo </span>a <span class="o">&gt;&gt;</span> src/a
rsync <span class="nt">-a</span> <span class="nt">--delete</span> <span class="nt">-b</span> <span class="nt">--backup-dir</span><span class="o">=</span>/home/yamo/rsynctest/bkp ~/rsynctest/src/ ~/rsynctest/dst
ll <span class="nt">-R</span>
<span class="nb">cat </span>bkp/<span class="k">*</span>
<span class="nb">cat </span>dst/<span class="k">*</span>
</code></pre></div></div>

<ul>
  <li>L’option <code class="language-plaintext highlighter-rouge">--backup-dir</code> ne supporte pas le <code class="language-plaintext highlighter-rouge">~</code></li>
  <li>L’option <code class="language-plaintext highlighter-rouge">-a</code>, comme archive, pour préserver la plupart des caractéristiques des fichiers.</li>
  <li>L’option <code class="language-plaintext highlighter-rouge">--delete</code> permet de supprimer un fichier de la destination quand il est supprimé de la
source</li>
  <li>L’option <code class="language-plaintext highlighter-rouge">-b</code> permet de garder un historique</li>
  <li>À savoir : le / à la fin de la source est important, il indique de copier le contenu du
répertoire.</li>
  <li>À savoir : les liens symboliques sont préservés mais pas les liens matériel</li>
</ul>

<p>Avec ce système, il est possible d’avoir un répertoire backup par jour de la semaine. Le problème
est que la restauration n’est pas immédiate : il faut rejouer la sauvegarde complète puis les
sauvegardes différentielles.</p>

<h2 id="sauvegarde-incrémentielle-de-type-snapshot">Sauvegarde incrémentielle de type snapshot</h2>

<p>C’est la Rolls-Royce de la sauvegarde. C’est une sauvegarde incrémentielle et qui apparait comme un
snapshot (c.-à-d. chaque sauvegarde semble complète) Ainsi, il suffit juste de recopier le
répertoire pour restaurer. Le secret réside dans l’utilisation de l’option <code class="language-plaintext highlighter-rouge">--link-dest</code> et une
rotation des répertoires.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync <span class="nt">-av</span> <span class="nt">--delete</span> <span class="nt">--link-dest</span><span class="o">=</span><span class="nv">$destdir</span>/backup.1 <span class="nv">$element</span> <span class="nv">$destdir</span>/backup.0
</code></pre></div></div>

<p>Le script complet est sur
<a href="https://github.com/YannMoisan/dotfiles/blob/master/bin/backup/">GitHub</a></p>

<p>Source :</p>

<ul>
  <li><a href="http://www.mikerubel.org/computers/rsync_snapshots/">http://www.mikerubel.org/computers/rsync_snapshots/</a></li>
  <li><a href="http://doc.ubuntu-fr.org/sauvegarde">http://doc.ubuntu-fr.org/sauvegarde</a></li>
</ul>


  </div><a class="u-url" href="/backup.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Yann Moisan</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yann Moisan</li><li><a class="u-email" href="mailto:yamo93+blog@gmail.com">yamo93+blog@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/YannMoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">YannMoisan</span></a></li><li><a href="https://www.linkedin.com/in/yann-moisan-01771746"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">yann-moisan-01771746</span></a></li><li><a href="https://www.twitter.com/yannmoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yannmoisan</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog de Yann Moisan Scala, Java, Linux</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
