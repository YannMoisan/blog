<!DOCTYPE html>
<html lang="fr"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="6C_Yu8j-I-U3pjFBjHojSiqvDPxhKJuYqap_tSXV8M4" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>awk vs Scala | Yann Moisan</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="awk vs Scala" />
<meta property="og:locale" content="fr" />
<meta name="description" content="awk vs Scala" />
<meta property="og:description" content="awk vs Scala" />
<link rel="canonical" href="https://www.yannmoisan.com/awk-vs-scala.html" />
<meta property="og:url" content="https://www.yannmoisan.com/awk-vs-scala.html" />
<meta property="og:site_name" content="Yann Moisan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-10-26T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="awk vs Scala" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2012-10-26T00:00:00+02:00","datePublished":"2012-10-26T00:00:00+02:00","description":"awk vs Scala","headline":"awk vs Scala","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yannmoisan.com/awk-vs-scala.html"},"url":"https://www.yannmoisan.com/awk-vs-scala.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" /><link type="application/atom+xml" rel="alternate" href="https://www.yannmoisan.com/feed.xml" title="Yann Moisan" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Yann Moisan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/">Posts</a><a class="page-link" href="/news-from-last-month.html">News from last month</a><a class="page-link" href="/a-propos.html">About me</a><a class="page-link" href="/bookmarks.html">Bookmarks</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">awk vs Scala</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-10-26T00:00:00+02:00" itemprop="datePublished">Oct 26, 2012
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Dans la série “the right tool for the right job”, j’ai besoin d’un petit programme qui filtre
certaines lignes d’un fichier, au format csv. Je veux filtrer les enregistrements pour lesquelles le
nombre de lignes contenant la première colonne est inférieur à un seuil, l’équivalent d’un
<code class="language-plaintext highlighter-rouge">HAVING(COUNT(*)) &gt; seuil</code> en SQL.</p>

<p>Prenons un exemple pour clarifier cela : un fichier pays.csv contenant des couples pays, ville</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>France,Paris
France,Grenoble
France,Marseille
Espagne,Barcelone
Espagne,Madrid
</code></pre></div></div>

<p>Le but est de supprimer tous les pays ayant moins de 3 villes.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>France,Paris
France,Grenoble
France,Marseille
</code></pre></div></div>

<p>J’ai voulu tester 2 approches différentes : une première en ligne de commandes et une deuxième avec
Scala.</p>

<h2 id="awk">awk</h2>

<p>La boite à outils Unix permettant de rendre des services inestimables, j’ai implémenté une version
avec awk :</p>

<div class="language-awk highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">awk</span> <span class="err">'</span><span class="kr">BEGIN</span> <span class="p">{</span> <span class="kc">FS</span><span class="o">=</span><span class="s2">","</span><span class="p">;</span> <span class="kc">OFS</span><span class="o">=</span><span class="s2">","</span><span class="p">}</span> <span class="p">{</span><span class="nx">id</span><span class="p">[</span><span class="nv">$0</span><span class="p">]</span><span class="o">=</span><span class="nv">$1</span><span class="p">;</span> <span class="nx">lines</span><span class="p">[</span><span class="nv">$0</span><span class="p">]</span><span class="o">=</span><span class="nv">$0</span><span class="p">;</span> <span class="nx">count</span><span class="p">[</span><span class="nv">$1</span><span class="p">]</span><span class="o">++</span><span class="p">;}</span> <span class="kr">END</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="nx">line</span> <span class="o">in</span> <span class="nx">lines</span><span class="p">)</span> <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">[</span><span class="nx">id</span><span class="p">[</span><span class="nx">line</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">print</span> <span class="nx">line</span><span class="p">}</span><span class="err">'</span> <span class="nx">pays</span><span class="p">.</span><span class="nx">csv</span>
</code></pre></div></div>

<h2 id="scala">Scala</h2>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.io.Source._</span>
<span class="k">import</span> <span class="nn">java.io.PrintWriter</span>

<span class="k">object</span> <span class="nc">awk</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="s">"/home/yamo/pays.res"</span><span class="o">)</span>

  <span class="nf">fromFile</span><span class="o">(</span><span class="s">"/home/yamo/pays.csv"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">getLines</span><span class="o">()</span>
    <span class="o">.</span><span class="py">toList</span>
    <span class="o">.</span><span class="py">groupBy</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">","</span><span class="o">)(</span><span class="mi">0</span><span class="o">))</span>
    <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_2</span><span class="o">.</span><span class="py">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">)</span>
    <span class="o">.</span><span class="py">flatMap</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_2</span><span class="o">)</span>
    <span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="nv">out</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>

  <span class="nv">out</span><span class="o">.</span><span class="py">close</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Étant débutant dans ces 2 langages, je pense que les solutions ne sont pas optimales. D’ailleurs,
n’hésitez pas à me proposer vos améliorations. L’implémentation AWK est plus concise, et utilise un
tableau mutable. Le code Scala est plus verbeux mais orienté fonctionnel et plus lisible.</p>

  </div><a class="u-url" href="/awk-vs-scala.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Yann Moisan</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yann Moisan</li><li><a class="u-email" href="mailto:yamo93+blog@gmail.com">yamo93+blog@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/YannMoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">YannMoisan</span></a></li><li><a href="https://www.linkedin.com/in/yann-moisan-01771746"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">yann-moisan-01771746</span></a></li><li><a href="https://www.twitter.com/yannmoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yannmoisan</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog de Yann Moisan Scala, Java, Linux</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
