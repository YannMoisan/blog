<!DOCTYPE html>
<html lang="fr"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="6C_Yu8j-I-U3pjFBjHojSiqvDPxhKJuYqap_tSXV8M4" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Manipuler une collection de Tuples en Scala | Yann Moisan</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Manipuler une collection de Tuples en Scala" />
<meta property="og:locale" content="fr" />
<meta name="description" content="Nous allons voir comment manipuler une collection de tuples en Scala. Nous utiliserons le pattern enrich-my-library pour avoir une API fluide." />
<meta property="og:description" content="Nous allons voir comment manipuler une collection de tuples en Scala. Nous utiliserons le pattern enrich-my-library pour avoir une API fluide." />
<link rel="canonical" href="https://www.yannmoisan.com/tuples.html" />
<meta property="og:url" content="https://www.yannmoisan.com/tuples.html" />
<meta property="og:site_name" content="Yann Moisan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-03-07T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Manipuler une collection de Tuples en Scala" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2015-03-07T00:00:00+01:00","datePublished":"2015-03-07T00:00:00+01:00","description":"Nous allons voir comment manipuler une collection de tuples en Scala. Nous utiliserons le pattern enrich-my-library pour avoir une API fluide.","headline":"Manipuler une collection de Tuples en Scala","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yannmoisan.com/tuples.html"},"url":"https://www.yannmoisan.com/tuples.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" /><link type="application/atom+xml" rel="alternate" href="https://www.yannmoisan.com/feed.xml" title="Yann Moisan" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Yann Moisan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/">Posts</a><a class="page-link" href="/news-from-last-month.html">News from last month</a><a class="page-link" href="/a-propos.html">About me</a><a class="page-link" href="/bookmarks.html">Bookmarks</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Manipuler une collection de Tuples en Scala</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2015-03-07T00:00:00+01:00" itemprop="datePublished">Mar 7, 2015
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>La librairie Scala n’offre pas de méthodes utilitaires sur des collections de tuples. Nous allons
voir comment implémenter un flatMap sur toutes les valeurs. Nous allons partir de l’implémentation
la plus simple qui vient à l’esprit pour l’améliorer progressivement.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">flatMapValues</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">s</span><span class="k">:</span><span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">Seq</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">)]</span> <span class="k">=</span> 
  <span class="nv">s</span><span class="o">.</span><span class="py">flatMap</span> <span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">b</span><span class="o">).</span><span class="py">map</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="k">_</span><span class="o">))</span> <span class="o">}</span>
</code></pre></div></div>

<p>Le code client est alors <code class="language-plaintext highlighter-rouge">flatMapValues(Seq("a"-&gt;1, "b"-&gt;2))(Seq.fill(_)("x"))</code>. Afin d’avoir un
code client <em>fluent</em>, on peut introduire une <a href="https://docs.scala-lang.org/sips/implicit-classes.html"><em>implicit
class</em></a>, qui permet de fournir des
méthodes d’extension à un type existant, une séquence de tuples ici.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">class</span> <span class="nc">TuplesOps</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)])</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">flatMapValues</span><span class="o">[</span><span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">Seq</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">)]</span> <span class="k">=</span>
    <span class="nv">s</span><span class="o">.</span><span class="py">flatMap</span> <span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">b</span><span class="o">).</span><span class="py">map</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="k">_</span><span class="o">))}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Le code client devient <code class="language-plaintext highlighter-rouge">Seq("a"-&gt;1, "b"-&gt;2).flatMapValues(Seq.fill(_)("x"))</code>. Malheureusement, un
surcoût se produit à l’exécution dû à l’instanciation de <code class="language-plaintext highlighter-rouge">TuplesOps</code>, c’est le <em>wrapping</em>. Or, cela
peut être évité en utilisant une <a href="http://docs.scala-lang.org/overviews/core/value-classes.html"><em>value
class</em></a> :</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">class</span> <span class="nc">TuplesOps</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="k">val</span> <span class="nv">s</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)])</span> <span class="k">extends</span> <span class="nc">AnyVal</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">flatMapValues</span><span class="o">[</span><span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">Seq</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">)]</span> <span class="k">=</span>
    <span class="nv">s</span><span class="o">.</span><span class="py">flatMap</span> <span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">b</span><span class="o">).</span><span class="py">map</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="k">_</span><span class="o">))}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Le problème est que ce code n’est pas assez générique. On ne peut pas appeler la méthode avec un
<code class="language-plaintext highlighter-rouge">Set</code> par exemple. Il va donc falloir utiliser une interface commune : <code class="language-plaintext highlighter-rouge">Traversable</code>, qui définit
les fonctions <code class="language-plaintext highlighter-rouge">map</code>, <code class="language-plaintext highlighter-rouge">flatMap</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">class</span> <span class="nc">TuplesOps</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="k">val</span> <span class="nv">s</span><span class="k">:</span> <span class="kt">Traversable</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)])</span> <span class="k">extends</span> <span class="nc">AnyVal</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">flatMapValues</span><span class="o">[</span><span class="kt">C</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">Traversable</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">Traversable</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">)]</span> <span class="k">=</span>
    <span class="nv">s</span><span class="o">.</span><span class="py">flatMap</span> <span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">b</span><span class="o">).</span><span class="py">map</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="k">_</span><span class="o">))}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Le problème est que peu importe le type de la collection, le retour sera toujours un <code class="language-plaintext highlighter-rouge">Traversable</code>,
nous forçant à une transformation explicite. Cependant, nous pouvons encore faire mieux en
reproduisant le principe <em>same-result-type</em> mis en oeuvre dans les collections Scala grâce au trait
<a href="http://docs.scala-lang.org/overviews/core/architecture-of-scala-collections.html#outline-of-class-traversablelike">TraversableLike</a>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">class</span> <span class="nc">TuplesOps</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">Repr</span> <span class="k">&lt;:</span> <span class="kt">Traversable</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)]](</span><span class="k">val</span> <span class="nv">s</span><span class="k">:</span> <span class="kt">TraversableLike</span><span class="o">[(</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">)</span>, <span class="kt">Repr</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AnyVal</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">flatMapValues</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">That</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=&gt;</span> <span class="nc">TraversableOnce</span><span class="o">[</span><span class="kt">C</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">bf</span><span class="k">:</span> <span class="kt">CanBuildFrom</span><span class="o">[</span><span class="kt">Repr</span>, <span class="o">(</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">)</span>, <span class="kt">That</span><span class="o">])</span> <span class="k">=</span>
    <span class="nv">s</span><span class="o">.</span><span class="py">flatMap</span> <span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">b</span><span class="o">).</span><span class="py">map</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="k">_</span><span class="o">))}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>L’écriture de code générique, élégant pour l’appelant, et performant requiert quelques efforts en
Scala…</p>

  </div><a class="u-url" href="/tuples.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Yann Moisan</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yann Moisan</li><li><a class="u-email" href="mailto:yamo93+blog@gmail.com">yamo93+blog@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/YannMoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">YannMoisan</span></a></li><li><a href="https://www.linkedin.com/in/yann-moisan-01771746"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">yann-moisan-01771746</span></a></li><li><a href="https://www.twitter.com/yannmoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yannmoisan</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog de Yann Moisan Scala, Java, Linux</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
