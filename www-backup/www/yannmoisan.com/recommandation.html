<!DOCTYPE html>
<html lang="fr"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="6C_Yu8j-I-U3pjFBjHojSiqvDPxhKJuYqap_tSXV8M4" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Système de recommandation avec Apache Mahout | Yann Moisan</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Système de recommandation avec Apache Mahout" />
<meta property="og:locale" content="fr" />
<meta name="description" content="Retour d’expérience sur la conception d’un système de recommandation avec Apache Mahout" />
<meta property="og:description" content="Retour d’expérience sur la conception d’un système de recommandation avec Apache Mahout" />
<link rel="canonical" href="https://www.yannmoisan.com/recommandation.html" />
<meta property="og:url" content="https://www.yannmoisan.com/recommandation.html" />
<meta property="og:site_name" content="Yann Moisan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-03-17T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Système de recommandation avec Apache Mahout" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-03-17T00:00:00+01:00","datePublished":"2014-03-17T00:00:00+01:00","description":"Retour d’expérience sur la conception d’un système de recommandation avec Apache Mahout","headline":"Système de recommandation avec Apache Mahout","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.yannmoisan.com/recommandation.html"},"url":"https://www.yannmoisan.com/recommandation.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" /><link type="application/atom+xml" rel="alternate" href="https://www.yannmoisan.com/feed.xml" title="Yann Moisan" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Yann Moisan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/">Posts</a><a class="page-link" href="/news-from-last-month.html">News from last month</a><a class="page-link" href="/a-propos.html">About me</a><a class="page-link" href="/bookmarks.html">Bookmarks</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Système de recommandation avec Apache Mahout</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-03-17T00:00:00+01:00" itemprop="datePublished">Mar 17, 2014
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Sur mon dernier projet, BlueKiwi, j’ai eu la chance de
travailler sur un système de recommandation. C’est une plateforme de gestion de contenu, et donc un
utilisateur peut lire ou noter des articles. Le but est donc de recommander des articles à un
utilisateur, en se basant sur ses interactions passées avec la plateforme. Cela s’appelle du
filtrage collaboratif (<em>collaborative filtering</em>). Nous allons voir les quelques difficultés
rencontrées.</p>

<p>La librairie choisie est <a href="http://mahout.apache.org/">Apache Mahout</a></p>

<h2 id="la-préférence">La préférence</h2>

<p>Les algorithmes utilisent une collection de triplets : utilisateur, article, préférence. La
préférence est optionnelle, elle indique la préférence de l’utilisateur pour l’article. Dans notre
cas, le produit étant assez riche, un utilisateur peut effectuer plusieurs actions sur un article
donné (lire, commenter, noter, …). La préférence est donc calculée avec une fonction <em>maison</em>. Son
choix est très important : cela a un impact sur l’éparpillement des données (par ex., un utilisateur
lit plus qu’il ne commente). La difficulté est qu’il est impossible de comparer les performances de
différentes fonctions car elles modifient le jeu de données en entrée.</p>

<h2 id="la-similarité">La similarité</h2>

<p>Le fonctionnement interne de ces algorithmes utilise une fonction de similarité pour déterminer la
distance entre deux utilisateurs. Il en existe plusieurs, chacune ayant ses avantages et
inconvénients.</p>

<p>Afin d’illustrer notre propos, voici un exemple de fichier CSV d’entrée au format (user, item,
préférence) :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1,101,5
1,102,3
1,103,1
2,101,5
2,103,3
2,104,4
2,106,4
</code></pre></div></div>

<h3 id="corrélation-de-pearson">Corrélation de Pearson</h3>

<p>mesure la tendance de deux utilisateurs a évolué ensemble proportionnellement.</p>

<p>Dans Mahout, pearson et cosine sont identiques car les données sont centrées.</p>

<p>Calcul : première étape, le centrage des vecteurs. Pour chaque vecteur (i.e. utilisateur), on
soustrait la valeur moyenne :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1,101,5-3=2
1,102,3-3=0
1,103,1-3=-2
2,101,5-4=1
2,103,3-4=-1
2,104,4-4=0
2,106,4-4=0
</code></pre></div></div>

<p>Deuxième étape, le calcul</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>x(u1)</th>
      <th>y(u2)</th>
      <th>xy</th>
      <th>x²</th>
      <th>y²</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>101</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <td>103</td>
      <td>1</td>
      <td>-1</td>
      <td>-1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Σ</td>
      <td> </td>
      <td> </td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>Voici la formule : Σxy/V(Σx²*Σy²), ce qui donne : 1/V5</p>

<p>Inconvénients</p>

<ul>
  <li>Le calcul ne prend pas en compte le nombre de préférences en commun, et a donc tendance à
éloigner des utilisateurs avec beaucoup de préférences communes. Pour pallier cela, il existe
une implémentation pondérée (<em>weighted</em>)</li>
  <li>Il est impossible de calculer la similarité entre deux utilisateurs ayant une seule préférence
en commun.</li>
</ul>

<h3 id="indice-de-tanimoto">Indice de Tanimoto</h3>

<p>C’est le rapport entre la taille de l’intersection par la taille de l’union. Il ne prend pas en
compte la valeur des préférences.</p>

<p>=2/(3+4-2)=2/5</p>

<h3 id="évaluation-du-système">Évaluation du système</h3>

<p>Il existe des techniques pour évaluer la qualité d’un système de recommandation en entrainant
l’algorithme sur une partie des données et en comparant les résultats obtenus avec le reste des
données.</p>

<p>Inconvénients</p>

<ul>
  <li>Elle pénalise les algorithmes qui font de bonnes recommandations, mais pour lesquelles
l’utilisateur n’a pas encore exprimé de préférences.</li>
  <li>Nous avons eu des divergences entre la qualité ressentie par les utilisateurs réels et celle
calculée automatiquement.</li>
  <li>Cela ne fonctionne pas bien quand les données sont éparpillées. La performance du système varie
beaucoup entre deux tirs, et parfois elle ne peut pas être calculée :
<code class="language-plaintext highlighter-rouge">java.lang.IllegalArgumentException: Illegal nDCG: NaN</code></li>
</ul>

<h3 id="hadoop-vs-taste">Hadoop vs Taste</h3>

<p>Une des forces de Mahout est de fournir deux implémentations (mono machine et distribuée avec
Hadoop) des mêmes algorithmes. Cependant, toutes les possibilités ne sont pas disponibles en
distribuée, comme par ex. l’<code class="language-plaintext highlighter-rouge">IDRescorer</code> que nous utilisons pour filtrer les données à posteriori.</p>

<h3 id="content-based">Content based</h3>

<p>Il est aussi possible d’utiliser un système de recommandation pour faire des recommandations basées
sur le contenu. On parle alors de <em>content based</em>. Le fichier d’entrée a alors le format : document,
term, tf idf. Le problème avec l’implémentation de Cosine est que deux documents avec un mot en
commun auront une similarité de 1, c’est-à-dire la valeur maximum.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Lors de la conception d’un système de recommandation, il faut donc penser à choisir le meilleur
algorithme de similarité, penser à l’évaluation de ce système, penser aux problèmes du démarrage à
froid (<em>cold start</em>). Par ailleurs, l’affichage des voisinages calculés permet de comprendre les
recommandations finales, utile en phase de debug.</p>

<h3 id="liens">Liens</h3>

<p><a href="http://brenocon.com/blog/2012/03/cosine-similarity-pearson-correlation-and-ols-coefficients/">pearson and
cosine</a></p>

  </div><a class="u-url" href="/recommandation.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Yann Moisan</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yann Moisan</li><li><a class="u-email" href="mailto:yamo93+blog@gmail.com">yamo93+blog@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/YannMoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">YannMoisan</span></a></li><li><a href="https://www.linkedin.com/in/yann-moisan-01771746"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">yann-moisan-01771746</span></a></li><li><a href="https://www.twitter.com/yannmoisan"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">yannmoisan</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog de Yann Moisan Scala, Java, Linux</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
