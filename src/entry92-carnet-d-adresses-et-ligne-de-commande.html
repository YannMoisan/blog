day=19
month=jan
year=2012
title=Carnet d'adresses et ligne de commande
-----
<p>Un bon développeur, comme tout bon artisan, doit utiliser les bons outils et les maitriser. L'outil incontournable, en raison notamment de sa puissance, est la ligne de commande. Afin de m'exercer, j'ai écrit une commande d'une ligne pour trier mes contacts par jour et mois de naissance. Avant toute chose, j'exporte le carnet d'adresses de Thunderbird au format CSV : Tools &gt; Adress Book puis Tools &gt; Export</p>
<p>Voici le code :</p>
<pre class="prettyprint linenums lang-sh">
cat ~/export.csv | 
    sed '1d' |                                                                         # 1
    sed -e 's/"[^"]*"//g' |                                                            # 2 
    awk -F, '$31 !~"^$" {print $0}' |                                                  # 3 
    cut -d, -f1,2,30-32 |                                                              # 4
    sort -g -t, -k4 -k5 |                                                              # 5
    awk -F, 'BEGIN {OFS=""} {printf "%0.2d/%0.2d/%4d %s %s\n", $5, $4, $3, $1, $2}'    # 6
</pre>
<ul>
    <li>1: supprime la ligne d'entête</li>
    <li>2: supprime le texte entre double quotes, car il peut contenir des virgules. Exemple : "25, rue de la Pie qui Chante"</li>
    <li>3: filtre les contacts dont la date de naissance n'est pas renseignée</li>
    <li>4: supprime les champs inutiles</li>
    <li>5: trie sur le jour et le mois, en gérant le padding optionnel</li>
    <li>6: formate joliment la sortie</li>
</ul>
Ce script fonctionne mais est perfectible. N'hésitez pas à m'envoyer vos idées d'amélioration, je mettrai à jour le billet.
