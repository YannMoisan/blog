$title=Ubuntu sur HP ProBook 4530s
$description=Notes d'installation d'Ubuntu sur un ordianteur portable HP ProBook 4530s
-----
<h2>Un nouveau portable</h2>
<p>J'ai acheté un PC portable HP ProBook 4530s, notamment pour un usage professionnel. Les atouts sont une dalle mate, un disque dur à 7200t et un processeur Intel Core i5 2410M dernière génération. L'ordinateur est pré-installé avec Windows 7 Pro. Après le premier boot, le système consomme 1,8 Go de RAM. 4 partitions sont utilisées :</p>
<ul>
    <li>ntfs  SYSTEM       300M boot</li>
    <li>ntfs  (C:)         442G</li>
    <li>ntfs  HP_RECOVERY  17,9G  </li>
    <li>fat32 HP_TOOLS     2,87G</li>
</ul>

<h2>Ubuntu</h2>
<p>Je suis un fidèle utilisateur d'Ubuntu, une distribution Linux facile d'accès. J'ai installé la version 11.04 Desktop AMD64 en dual boot avec Windows. Je partage cette expérience à travers ce billet car j'ai rencontré différents problèmes.</p>

<h2>1er problème: le partitionnement</h2>
<p>Un disque dur ne peut pas contenir plus de 4 partitions primaires. La solution consiste à supprimer une partition pour pouvoir créer une partition étendue. Je sauvegarde donc HP_TOOLS sur une clé USB, supprime la partition et redimensionne la partition C: Je redémarre alors Windows pour mettre à jour la table de partition.
Je boote alors sur le CD d'installation et sur l'écran 'Preparing to install Ubuntu', je coche les cases 
Download updates while installing
Install this third-party software
Sur l'écran 'Allocate Drive Space', je choisis Install ubuntu alongside pour le dual-boot avec Windows.

L'installation a créé 3 partitions :</p>
<ul>
    <li>une partion étendue</li>
    <li>une partition pour la racine (/) en ext4</li>
    <li>une partition de swap</li>
</ul>
<p>Tous les périphériques fonctionnent correctement : le wifi, la webcam, le microphone, les touches de fonction, le touchpad. Le seul problème rencontré est que le double tap LED pour désactiver le touchpad ne fonctionne pas. Les logiciels non libres (flash et MP3) fonctionne aussi après l'installation.</p>

<h2>2ème problème: l'amorçage</h2>
<p>Pour vérifier le bon fonctionnement du dual boot, je démarre Windows. Pas de problème. Puis je démarre à nouveau Ubuntu. Le menu de Grub s'affiche bien mais le système reste bloqué pendant le démarrage ... Après recherche, il s'agit d'un problème spécifique à Windows/HP qui écrit dans le MBR au détriment de Grub 2. Il suffit de désactiver le service HP Software Framework Service (hpqwmiex.exe) et de restaurer Grub 2. Au menu de grub, sélectionner recovery mode et, au recovery menu, sélectionner Update grub bootloader.</p>
<h2>3ème problème: la carte graphique</h2>
<p>L'ordinateur possède deux cartes graphiques : une carte intégrée au processeur et une carte AMD Radeon HD 6470M dédiée. Le but est d'optimiser la consommation d'énergie en basculant sur la carte dédiée uniquement en cas de besoin. Malheureusement, cette technique fonctionne encore mal sous Linux car le serveur X a besoin d'un redémarrage pour le switch.</p>
<p>Après une mise à jour du système, le système reste bloqué pendant le démarrage. Après recherche, c'est lié à la carte graphique.
Une solution, assez bourrine, consiste à désactiver Switchable Graphics dans le BIOS. Ainsi, le sytème n'utilise que la carte embarqué avec le processeur, comme l'indique la commande <code>lspci|grep VGA</code>.
</p>

<h2>4ème problème: la carte Wifi</h2>
<p>La connexion Wifi souffre de lenteurs. C'est dû à l'utilisation du driver ath9k de la carte Atheros avec un noyau 2.6.38. La solution consiste simplement à executer cette commande :</p>
<pre>
sudo -s
echo "options ath9k nohwcrypt=1" &gt; /etc/modprobe.d/ath9k.conf
</pre>
<p>Tous les problèmes étant maintenant résolus, on va faire quelques réglages :</p>
<h2>Paramétrage du BIOS</h2>
<p>Par rapport à mon précédent portable, le BIOS offre beaucoup plus de paramètres.C'est en partie lié au passage à UEFI et HP qui permet la configuration de ses programmes dans le BIOS. Ces programmes ne sont pas compatibles avec Linux. J'aime désactiver les choses que je n'utilise pas. J'ai donc décoché les options suivantes</p>
<ul>
    <li>
    Device Configurations:
    <ul>
        <li>USB Legacy Support</li>
        <li>HP Day Starter</li>
        <li>HP Quick Web</li>
        <li>Numlock On (coché), mais malheureusement çà ne fonctionne pas!</li>
    </ul>
    </li>
    <li>
    Built-in Device Options:
    <ul>
        <li>Embedded Bluetooth Device</li>
        <li>Wake on LAN (disable)</li>
    </ul>
    </li>
    <li>
    Port Options:
    <ul>
        <li>Express Card</li>
    </ul>
    </li>
</ul>
<h2>Optimisation du démarrage</h2>
<p>Comme indiqué précedemment, Ubuntu est une distribution simple. Le revers de la médaille est le démarrage par défaut de programmes que je n'utilise pas. J'ai donc décoché dans Startup Application :</p>
<ul>
    <li>Bluetooth Manager</li>
    <li>Check for new hardware drivers</li>
    <li>GNOME Login Sound</li>
    <li>Personal File Sharing</li>
    <li>Remote Desktop</li>
    <li>Update Notifier</li>
    <li>Ubuntu One</li>
    <li>User folders update</li>
    <li>Visual Assistance</li>
    <li>Zeitgeist Datahub (mais malheureusement le service démarre quand-même)</li>
</ul>
<p>Après le démarrage, le système consomme 400Mo de RAM (4 fois moins que Win 7 !!!)</p>

<h2>Quelques pistes à faire après l'installation</h2>
<p>La configuration du touchpad : je désactive le clic avec le touchpad (pour éviter l'insupportable déplacement du curseur pendant la frappe) et j'utilise le scroll à deux doigts.</p>
<p>Installation de numlockx afin de vérouiller automatiquement le pavé numérique avant la connection.</p>

<h2>Conclusion</h2>
<p>Malheureusement, l'installation fut plus laborieuse que ce que j'imaginais. Mais une fois cette étape passée, le sytème fonctionne impeccablement (pas comme Windows ...). J'essayerai l'installation de la version 11.10 prochainement pour voir si la situation s'est améliorée.</p>
